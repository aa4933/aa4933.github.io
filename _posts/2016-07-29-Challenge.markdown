---
layout:     post
title:      "破解今日头条接口--详解TCP/UDP/HTTP协议"
subtitle:   "知识集合+例子阐述"
date:       2016-07-29 18:50:00
author:     "wulihh"
header-img: "img/post-bg-2016-07_09.jpg"
tags:
    - PHP
---
> “challenge”

## 破解今日头条接口

关于TCP/UDP/HTTP协议,我一直想找个机会记录一下，

毕竟协议之前对我的影响挺大的，正好我有一个需求是

把132开头7076结尾的手机号分析出完整帐号，所以

今天我们就以破解今日头条内置接口的数据为例子

好好讲讲协议，好吧，其实协议和破解接口并没有半毛

钱关系，纯粹是为了增加趣味性

### TCP/UDP/IP/HTTP协议

一讲到这个，我们就得开始学校级别的长篇大论了

![enter image description here](http://zengrong.net/wp-content/uploads/2014/12/TCP-IP.gif)

首先，我们要搞清楚，虽然都是协议，但是，他们完全

不一样，最显著的原因就是他们的供职层面不同，就跟

现实中，一个是挖煤的，一个是搬砖的，一个是开车

的，八竿子打不着一边啊！

* TCP/UDP

为啥把这俩放一起呢，因为这俩都是在同一层的，就跟

兄弟一样，这俩协议，都是传输层的协议

但是TCP比较严谨，会有3次握手，什么是三次握手呢，

如果是科班出身的，肯定会有印象

1.客户端发包给服务端，问：大哥在不
2.服务端返回给客户端，答：在的
3.客户端收到回答，发送确认包

最后确认包发送完毕，客户端/服务端进入ESTABLISHED

状态，完成握手，完成握手以后，才正式开始发送数据

当然，断开过程需要经过`四次握手`

至于UDP比较随意，他不会与对方建立连接，而是直接把包发出去！

正因为如此，UDP通信效率比TCP高，但是可靠性就差了很多

* IP

这个协议正如图所示，在第三层网络层，非常底层的协

议，几乎你干啥都要IP协议，没有IP协议，你啥也干不

了，不管你是啥项目，通不了网络都白搭

* HTTP

这个协议，也就是所有我们提及到的协议中最上层的协

议，也就是我们接触最多的协议，HTTP协议，这个协议

做web用到100%，就不多说了，这个要是忘了，那就真

的，白写代码了！

当然，除了协议，我还得讲个

* socket

这东西与最近流行的Html5的`webSocket`必须要好好讲

讲，首先socket是啥玩意儿呢，首先，这东西不是协

议，记住，不是协议！

![enter image description here](http://zengrong.net/wp-content/uploads/2014/12/socket.gif)

更像是调用接口的API，简单来说，通过Socket，我们才

能使用TCP/IP协议，它提供了一个针对TCP或UDP编程的

接口，那么

* WebSocket

则完全不同，它是一个完完整整的应用层协议，不要以

为WebSocket只能用于web，实际上许多的应用程序，皆

可使用这个协议，对于WebSocket来说，它必须依赖于

HTTP的第一次握手，握手成功以后，数据就直接从TCP

通道传输了，与HTTP无关了

* 总结

CSDN上有个比较形象的描述：

HTTP是轿车，提供了封装或者显示数据的具体式

Socket是发动机，提供了网络通信的能力。

　　实际上，传输层的TCP是基于网络层的IP协议的，而

应用层的HTTP协议又是基于传输层的TCP协议的，而

Socket本身不算是协议，就像上面所说，它只是提供了

一个针对TCP或者UDP编程的接口。

### 今日头条接口破解

其实写日志的目的主要是为了记录下TCP的原理

破解就简单带过啦

* 方法1
	使用到的工具软件
	* Charles
	* JEB<可能用不到>
	* 自备安卓机/苹果机

使用Charles配置端口，在安卓苹果机子上面配置好代理服务器，弄好ssl证书，然后在手机上面打开软件，进到今日头条的登录界面，输入任意帐号，发送http请求

然后包就被Charles抓到，然后就OK了

本来想法是破解注册接口，后来朋友说注册接口的监测更加严格，毕竟发手机短信都是钱啊！

* 方法2
		找朋友帮忙分析今日头条APK，使用JEB分析代码，找到代码入口，找到登录的URL

 我有一个朋友搞逆向安卓，分析了大概半天左右

结果：

http://ic.snssdk.com/user/mobile/login/?password=xxx&mobile=13200017076

这个就是今日头条的登录接口了

接口封锁频率在330次左右，也就是使用330次就会出验

证码，还是得谨慎使用，我一开始写了一个脚本1秒钟跑

10次，导致接口很快出验证码，后来2秒一次才正常了几

百次，跑脚本注意要记录，否则数据就白跑了







